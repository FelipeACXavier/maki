name: Build dev Docker image

on:
  # Run manually from the Actions tab
  workflow_dispatch: {}

jobs:
  build-dev-image:
    # Must be your Linux self-hosted runner with Docker installed
    runs-on: self-hosted

    steps:
      # 1) Checkout the repo so Docker has the full build context
      - name: Checkout
        uses: actions/checkout@v4

      # 2) Log in to GHCR (GitHub Container Registry) using the GitHub token
      - name: Log in to GHCR
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # 3) Build and push the dev image
      - name: Build and push dev image
        uses: docker/build-push-action@v6
        with:
          # Repo root as context
          context: .
          # Dockerfile outside root (adjust path if needed)
          file: ./docker/Dockerfile
          push: true
          # Centralised image tag (e.g. dev:qt6.5)
          tags: ghcr.io/felipeacxavier/maki/dev:${{ vars.QT_DEV_TAG }}
          # Pass Qt version into the Dockerfile
          build-args: |
            QT_VERSION=${{ vars.QT_VERSION }}
